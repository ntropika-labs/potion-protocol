<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for vault/InvestmentVault.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">vault/</a> InvestmentVault.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">73.33% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>55/75</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">40.38% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>21/52</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">60% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>9/15</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">71.26% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>62/87</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-yes">90×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">90×</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-yes">45×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
 * SPDX-License-Identifier: Apache-2.0
 */
pragma solidity 0.8.14;
&nbsp;
import "./BaseVaultUpgradeable.sol";
import "../library/PercentageUtils.sol";
import "../versioning/InvestmentVaultV0.sol";
&nbsp;
import { SafeERC20Upgradeable as SafeERC20 } from "@openzeppelin/contracts-upgradeable-4.7.3/token/ERC20/utils/SafeERC20Upgradeable.sol";
import { IERC20Upgradeable as IERC20 } from "@openzeppelin/contracts-upgradeable-4.7.3/token/ERC20/IERC20Upgradeable.sol";
&nbsp;
/**
    @title InvestmentVault
&nbsp;
    @author Roberto Cano &lt;robercano&gt;
    
    @notice Investment Vault contract that implements an investment strategy via the configured actions in the vault
&nbsp;
    @dev The responsibility of the Vault is to accept immediate deposits and withdrawals while the vault is in the Unlocked state.
    Then when the position is entered, it executes the investment actions in the configured order. If all actions succeed,
    then the Vault is Locked and no more deposits or withdrawals are allowed. The moment the position can be exited, the vault
    exits the position of all actions, also in order, and receives back the remaining funds, including profit or loss
&nbsp;
    TODO: Explain the current version of the vault in detail
    
    @dev See {BaseVaultUpgradeable}
 */
&nbsp;
contract InvestmentVault is BaseVaultUpgradeable, InvestmentVaultV0 {
    using PercentageUtils for uint256;
    using SafeERC20 for IERC20;
&nbsp;
    // UPGRADEABLE INITIALIZER
&nbsp;
    /**
        @custom:member adminAddress The address of the admin of the Vault
        @custom:member strategistAddress The address of the strategist of the Vault
        @custom:member operatorAddress The address of the operator of the Vault
        @custom:member underlyingAsset The address of the asset managed by this vault
        @custom:member underlyingAssetCap The cap on the amount of principal that the vault can manage
        @custom:member managementFee The fee percentage charged for the management of the Vault
        @custom:member performanceFee The fee percentage charged for the performance of the Vault
        @custom:member feesRecipient The address of the account that will receive the fees
        @custom:member actions The list of investment actions to be executed in the Vault
        @custom:member principalPercentages The list of principal percentages for the default strategy
        @custom:member sharesName The name of the shares token
        @custom:member sharesSymbol The symbol of the shares token
     */
    struct InvestmentVaultInitParams {
        address adminAddress;
        address strategistAddress;
        address operatorAddress;
        address underlyingAsset;
        uint256 underlyingAssetCap;
        uint256 managementFee;
        uint256 performanceFee;
        address payable feesRecipient;
        IAction[] actions;
        uint256[] principalPercentages;
        string sharesName;
        string sharesSymbol;
    }
&nbsp;
    /// INITIALIZERS
&nbsp;
    /**
       @notice Takes care of the initialization of all the contracts hierarchy. Any changes
        to the hierarchy will require to review this function to make sure that no initializer
        is called twice, and most importantly, that all initializers are called here
&nbsp;
        @param initParams Initialization parameters for the Investment Vault
&nbsp;
        @dev See { InvestmentVaultInitParams }
&nbsp;
     */
    function initialize(InvestmentVaultInitParams calldata initParams) external <span class="missing-if-branch" title="else path not taken" >E</span>initializer {
        // Prepare the list of tokens that are not allowed to be refunded. In particular the underlying
        // asset is not allowed to be refunded to prevent the admin from accidentally refunding the
        // underlying asset
        address[] memory cannotRefundToken = new address[](1);
        cannotRefundToken[0] = initParams.underlyingAsset;
&nbsp;
        __RolesManager_init_unchained(initParams.adminAddress, initParams.operatorAddress);
        __ERC20_init_unchained(initParams.sharesName, initParams.sharesSymbol);
        __ERC4626Cap_init_unchained(initParams.underlyingAssetCap, initParams.underlyingAsset);
        __EmergencyLock_init_unchained();
        __LifecycleStates_init_unchained();
        __RefundsHelper_init_unchained(cannotRefundToken, false);
        __FeeManager_init_unchained(initParams.managementFee, initParams.performanceFee, initParams.feesRecipient);
        __ActionsManager_init_unchained(initParams.actions);
        __ReentrancyGuard_init_unchained();
&nbsp;
        _grantRole(RolesManagerUpgradeable.STRATEGIST_ROLE, initParams.strategistAddress);
        _setDefaultStrategy(initParams.actions, initParams.principalPercentages);
    }
&nbsp;
    /// STATE CHANGERS
&nbsp;
    /**
        @inheritdoc IVaultV0
     */
    function enterPosition() external <span class="missing-if-branch" title="else path not taken" >E</span>onlyOperator <span class="missing-if-branch" title="else path not taken" >E</span>onlyUnlocked <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant {
        _enterPosition(DefaultStrategy);
    }
&nbsp;
    /**
        @inheritdoc IVaultV0
     */
    function enterPositionWith(Strategy calldata strategy) external <span class="missing-if-branch" title="else path not taken" >E</span>onlyOperator <span class="missing-if-branch" title="else path not taken" >E</span>onlyUnlocked <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant {
        _enterPosition(strategy);
    }
&nbsp;
    /**
        @inheritdoc IVaultV0
    */
    // @audit The external call to action.exitPosition is trusted but the action will eventually
    // call some other external contracts that may not be trusted. This needs further analysis but
    // for the Testnet Competition it should be fine as we control all the contracts in the system.
&nbsp;
    function exitPosition() external <span class="missing-if-branch" title="else path not taken" >E</span>onlyOperator <span class="missing-if-branch" title="else path not taken" >E</span>onlyLocked <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant returns (uint256 newPrincipalAmount) {
        address investmentAsset = asset();
&nbsp;
        uint256 totalAmountReturned = 0;
&nbsp;
        uint256 numActions = _lastStrategy.actionsIndexes.length;
&nbsp;
        for (uint256 i = 0; i &lt; numActions; i++) {
            uint256 actionIndex = _lastStrategy.actionsIndexes[i];
            IAction action = getAction(actionIndex);
&nbsp;
            totalAmountReturned += action.exitPosition(investmentAsset);
&nbsp;
            IERC20(investmentAsset).safeApprove(address(action), 0);
        }
&nbsp;
        _setLifecycleState(LifecycleState.Unlocked);
&nbsp;
        newPrincipalAmount = totalAssets();
&nbsp;
        // TODO: Apply fees here
&nbsp;
        emit VaultPositionExited(newPrincipalAmount, _lastStrategy);
    }
&nbsp;
    /**
        @inheritdoc ERC4626Upgradeable
     */
    function deposit(uint256 assets, address receiver)
        public
        override(ERC4626Upgradeable, IERC4626Upgradeable)
        <span class="missing-if-branch" title="else path not taken" >E</span>onlyUnlocked
        <span class="missing-if-branch" title="else path not taken" >E</span>onlyInvestor
        returns (uint256)
    {
        return super.deposit(assets, receiver);
    }
&nbsp;
    /**
        @inheritdoc ERC4626Upgradeable
    */
<span class="fstat-no" title="function not covered" >    function mint(uint256 shares, address receiver)</span>
        public
        override(ERC4626Upgradeable, IERC4626Upgradeable)
        onlyUnlocked
        onlyInvestor
        returns (uint256)
    {
<span class="cstat-no" title="statement not covered" >        return super.mint(shares, receiver);</span>
    }
&nbsp;
    /**
        @inheritdoc ERC4626Upgradeable
    */
<span class="fstat-no" title="function not covered" >    function withdraw(</span>
        uint256 assets,
        address receiver,
        address owner
    ) public override(ERC4626Upgradeable, IERC4626Upgradeable) onlyUnlocked onlyInvestor returns (uint256) {
<span class="cstat-no" title="statement not covered" >        return super.withdraw(assets, receiver, owner);</span>
    }
&nbsp;
    /**
        @inheritdoc ERC4626Upgradeable
    */
    function redeem(
        uint256 shares,
        address receiver,
        address owner
    ) public override(ERC4626Upgradeable, IERC4626Upgradeable) <span class="missing-if-branch" title="else path not taken" >E</span>onlyUnlocked <span class="missing-if-branch" title="else path not taken" >E</span>onlyInvestor returns (uint256) {
        return super.redeem(shares, receiver, owner);
    }
&nbsp;
    /// GETTERS
&nbsp;
    /**
        @inheritdoc IVaultV0
     */
<span class="fstat-no" title="function not covered" >    function canPositionBeEntered() external view returns (bool canEnter) {</span>
<span class="cstat-no" title="statement not covered" >        return _canPositionBeEnteredWith(DefaultStrategy);</span>
    }
&nbsp;
    /**
        @inheritdoc IVaultV0
     */
<span class="fstat-no" title="function not covered" >    function canPositionBeEnteredWith(Strategy calldata strategy) external view returns (bool canEnter) {</span>
<span class="cstat-no" title="statement not covered" >        return _canPositionBeEnteredWith(strategy);</span>
    }
&nbsp;
    /**
        @inheritdoc IVaultV0
    */
    // @audit The external call to action.canPositionBeExited is trusted but the action will
    // eventually call some other external contracts that may not be trusted. This needs further
    // analysis but for the Testnet Competition it should be fine as we control all the contracts in the system
&nbsp;
<span class="fstat-no" title="function not covered" >    function canPositionBeExited() external view returns (bool canExit) {</span>
<span class="cstat-no" title="statement not covered" >        uint256 numActions = _lastStrategy.actionsIndexes.length;</span>
<span class="cstat-no" title="statement not covered" >        address investmentAsset = asset();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        for (uint256 i = 0; i &lt; numActions; i++) {</span>
<span class="cstat-no" title="statement not covered" >            uint256 actionIndex = _lastStrategy.actionsIndexes[i];</span>
<span class="cstat-no" title="statement not covered" >            IAction action = getAction(actionIndex);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (!action.canPositionBeExited(investmentAsset)) {</span>
<span class="cstat-no" title="statement not covered" >                return false;</span>
            }
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        return true;</span>
    }
&nbsp;
    /// INTERNALS
&nbsp;
    /**
        @notice Sets the default strategy that will be used when no strategy is given in the `enterPosition` call
&nbsp;
        @param actions The list of actions to be executed in the strategy
        @param principalPercentages The list of percentages of the principal that will be used for each action
&nbsp;
        @dev The length of the actions and principalPercentages arrays must be the same
     */
    function _setDefaultStrategy(IAction[] calldata actions, uint256[] calldata principalPercentages) private {
        <span class="missing-if-branch" title="if path not taken" >I</span>if (principalPercentages.length != actions.length) {
            revert PrincipalPercentagesMismatch(actions.length, principalPercentages.length);
        }
&nbsp;
        for (uint256 i = 0; i &lt; actions.length; i++) {
            uint256 percentage = principalPercentages[i];
&nbsp;
            // If the percentage is 0, skip this action for the default strategy
            if (percentage == 0) {
                continue;
            }
&nbsp;
            DefaultStrategy.actionsIndexes.push(i);
            DefaultStrategy.principalPercentages.push(percentage);
        }
    }
&nbsp;
    /**
        @notice See { setPrincipalPercentages }
     */
    function _validatePrincipalPercentages(Strategy memory strategy) private pure returns (uint256 totalPercentage) {
        uint256 numActions = strategy.actionsIndexes.length;
        uint256 numPercentages = strategy.principalPercentages.length;
&nbsp;
        <span class="missing-if-branch" title="if path not taken" >I</span>if (numPercentages != numActions) {
            revert PrincipalPercentagesMismatch(strategy.actionsIndexes.length, strategy.principalPercentages.length);
        }
&nbsp;
        uint256 sumPrincipalPercentages = 0;
&nbsp;
        for (uint256 i = 0; i &lt; numPercentages; i++) {
            uint256 percentage = strategy.principalPercentages[i];
            <span class="missing-if-branch" title="if path not taken" >I</span>if (percentage &gt; PercentageUtils.PERCENTAGE_100) {
                revert PrincipalPercentageOutOfRange(strategy, i);
            }
&nbsp;
            sumPrincipalPercentages += percentage;
        }
&nbsp;
        <span class="missing-if-branch" title="if path not taken" >I</span>if (sumPrincipalPercentages &gt; PercentageUtils.PERCENTAGE_100) {
            revert PrincipalPercentagesSumMoreThan100(strategy);
        }
&nbsp;
        return sumPrincipalPercentages;
    }
&nbsp;
    /**
        @notice Enters a position in the Vault. The strategy is used to determine the actions to be
                executed in order to enter the position
&nbsp;
        @param strategy The strategy to be used to enter the position
     */
    function _enterPosition(Strategy memory strategy) private {
        _setLifecycleState(LifecycleState.Locked);
&nbsp;
        uint256 totalPercentage = _validatePrincipalPercentages(strategy);
&nbsp;
        uint256 totalPrincipalAmount = totalAssets();
&nbsp;
        uint256 maxAmountToInvest = totalPercentage.applyPercentage(totalPrincipalAmount);
        uint256 actualAmountInvested = 0;
        address investmentAsset = asset();
&nbsp;
        uint256 numActions = strategy.actionsIndexes.length;
&nbsp;
        for (uint256 i = 0; i &lt; numActions; i++) {
            uint256 actionIndex = strategy.actionsIndexes[i];
&nbsp;
            IAction action = getAction(actionIndex);
&nbsp;
            uint256 amountToInvest = strategy.principalPercentages[i].applyPercentage(totalPrincipalAmount);
&nbsp;
            IERC20(investmentAsset).safeApprove(address(action), amountToInvest);
&nbsp;
            action.enterPosition(investmentAsset, amountToInvest);
&nbsp;
            actualAmountInvested += amountToInvest;
        }
&nbsp;
        <span class="missing-if-branch" title="if path not taken" >I</span>if (actualAmountInvested &gt; maxAmountToInvest) {
            revert InvestmentTotalTooHigh(actualAmountInvested, maxAmountToInvest);
        }
&nbsp;
        _lastStrategy = strategy;
&nbsp;
        emit VaultPositionEntered(totalPrincipalAmount, actualAmountInvested, strategy);
    }
&nbsp;
    /**
        @notice Checks if the position can be entered for the given strategy
&nbsp;
        @param strategy The strategy to be used to enter the position
&nbsp;
        @return canEnter True if the position can be entered for the given strategy, false otherwise
     */
<span class="fstat-no" title="function not covered" >    function _canPositionBeEnteredWith(Strategy memory strategy) private view returns (bool canEnter) {</span>
<span class="cstat-no" title="statement not covered" >        uint256 numActions = strategy.actionsIndexes.length;</span>
<span class="cstat-no" title="statement not covered" >        address investmentAsset = asset();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        for (uint256 i = 0; i &lt; numActions; i++) {</span>
<span class="cstat-no" title="statement not covered" >            uint256 actionIndex = strategy.actionsIndexes[i];</span>
<span class="cstat-no" title="statement not covered" >            IAction action = getAction(actionIndex);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (!action.canPositionBeEntered(investmentAsset)) {</span>
<span class="cstat-no" title="statement not covered" >                return false;</span>
            }
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        return true;</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Dec 01 2022 09:09:45 GMT+0100 (Central European Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
